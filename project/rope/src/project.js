window.__require=function o(t,n,e){function s(c,r){if(!n[c]){if(!t[c]){var h=c.split("/");if(h=h[h.length-1],!t[h]){var l="function"==typeof __require&&__require;if(!r&&l)return l(h,!0);if(i)return i(h,!0);throw new Error("Cannot find module '"+c+"'")}}var a=n[c]={exports:{}};t[c][0].call(a.exports,function(o){return s(t[c][1][o]||o)},a,a.exports,o,t,n,e)}return n[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<e.length;c++)s(e[c]);return s}({CanvasScr:[function(o,t,n){"use strict";cc._RF.push(t,"e1832eYNypLTogNFy5oynN9","CanvasScr"),Object.defineProperty(n,"__esModule",{value:!0});var e=cc._decorator,s=e.ccclass,i=e.property,c=function(){return cc.Vec2,cc.Vec2,cc.Node,function(o,t,n){this.worldPos=o,this.normal=t,this.column=n}}(),r=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.PointArea=null,t.ropeEnd=null,t.ci=null,t.mouseWorldPos=new cc.Vec2(0,0),t.points=[],t.ctx=null,t}return __extends(t,o),t.prototype.onLoad=function(){this.ctx=this.getComponent(cc.Graphics),this.PointArea.on("touchstart",this.touchstart,this),this.PointArea.on("touchmove",this.touchmove,this),this.PointArea.on("touchend",this.touchup,this),cc.director.getPhysicsManager().enabled=!0,this.points.push(new c(this.node.parent.convertToWorldSpaceAR(this.node.position),new cc.Vec2(0,0),this.node)),this.flag=!1},t.prototype.touchstart=function(o){this.flag=!0,this.mouseWorldPos=o.getLocation().add(new cc.Vec2(0,30))},t.prototype.touchmove=function(o){this.mouseWorldPos=o.getLocation().add(new cc.Vec2(0,30))},t.prototype.touchup=function(o){this.flag=!1},t.prototype.start=function(){},t.prototype.update=function(o){this.flag?this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.mouseWorldPos.sub(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).mul(3):this.ropeEnd.convertToNodeSpaceAR(this.points[this.points.length-1].worldPos).mag()<10?this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.ropeEnd.convertToNodeSpaceAR(this.points[this.points.length-1].worldPos).mul(10):this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.ropeEnd.convertToNodeSpaceAR(this.points[this.points.length-1].worldPos).normalize().mul(1e3);var t=cc.director.getPhysicsManager().rayCast(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.points[this.points.length-1].worldPos,cc.RayCastType.Any);if(this.ctx.lineWidth=10,this.ctx.clear(),this.ctx.LineJoin=cc.Graphics.LineJoin.ROUND,this.ctx.lineCap=cc.Graphics.LineCap.ROUND,t.length>=1&&"ropeEnd"!=t[0].collider.node.name){var n=t[0].point;n=n.add(t[0].normal.normalize().mul(5));var e=new c(n,t[0].normal,t[0].collider.node);this.points.push(e)}for(;this.points.length>1;){if(!(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position).sub(this.points[this.points.length-1].worldPos).angle(this.points[this.points.length-1].normal)<Math.PI/2-.5))break;this.points.pop()}this.ctx.moveTo(this.node.convertToNodeSpaceAR(this.points[0].worldPos).x,this.node.convertToNodeSpaceAR(this.points[0].worldPos).y);for(var s=1;s<this.points.length;s++)this.ctx.lineTo(this.node.convertToNodeSpaceAR(this.points[s].worldPos).x,this.node.convertToNodeSpaceAR(this.points[s].worldPos).y);this.ctx.lineTo(this.node.convertToNodeSpaceAR(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).x,this.node.convertToNodeSpaceAR(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).y);var i=this.CalcQieDian(this.ci.parent.convertToWorldSpaceAR(this.ci.position),this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),20);this.ctx.circle(this.node.convertToNodeSpaceAR(i).x,this.node.convertToNodeSpaceAR(i).y,5),this.ctx.stroke()},t.prototype.CalcQieDian=function(o,t,n){var e=new cc.Vec2(0,0),s=new cc.Vec2(0,0),i=new cc.Vec2(0,0),c=new cc.Vec2(0,0),r=n;e.x=t.x-o.x,e.y=t.y-o.y;var h=r/Math.sqrt(e.x*e.x+e.y*e.y);s.x=e.x*h,s.y=e.y*h;var l=-Math.acos(h);return i.x=s.x*Math.cos(l)-s.y*Math.sin(l),i.y=s.x*Math.sin(l)+s.y*Math.cos(l),c.x=i.x+o.x,c.y=i.y+o.y,c},__decorate([i(cc.Node)],t.prototype,"PointArea",void 0),__decorate([i(cc.Node)],t.prototype,"ropeEnd",void 0),__decorate([i(cc.Node)],t.prototype,"ci",void 0),t=__decorate([s],t)}(cc.Component);n.default=r,cc._RF.pop()},{}],DrawImage:[function(o,t,n){"use strict";cc._RF.push(t,"fb6a1v0ZzdFqJgJF8qQyaA+","DrawImage"),Object.defineProperty(n,"__esModule",{value:!0});var e=cc._decorator,s=e.ccclass,i=e.property,c=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.sp=null,t}return __extends(t,o),t.prototype.onLoad=function(){this.ctx=this.node.getComponent(cc.Graphics);var o=sp;this.ctx.drawimage(o,10,10)},t.prototype.start=function(){},__decorate([i(cc.SpriteFrame)],t.prototype,"sp",void 0),t=__decorate([s],t)}(cc.Component);n.default=c,cc._RF.pop()},{}],columnScr:[function(o,t,n){"use strict";cc._RF.push(t,"d76cfZ+zxpODIY9D0DJlcP2","columnScr"),Object.defineProperty(n,"__esModule",{value:!0});var e=cc._decorator,s=e.ccclass,i=(e.property,function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return __extends(t,o),t.prototype.onLoad=function(){this.ifLight=!1,this.node.color=cc.Color.WHITE},t.prototype.onLight=function(){this.ifLight||(this.node.color=cc.Color.ORANGE,this.ifLight=!0)},t.prototype.cancelLight=function(){this.ifLight&&(this.ifLight=!1,this.node.color=cc.Color.WHITE)},t.prototype.start=function(){},t=__decorate([s],t)}(cc.Component));n.default=i,cc._RF.pop()},{}],"ropeScr - 001":[function(o,t,n){"use strict";cc._RF.push(t,"55181x9yKBGbrV/vEm6+JlN","ropeScr - 001"),Object.defineProperty(n,"__esModule",{value:!0});var e=cc._decorator,s=e.ccclass,i=e.property,c=function(){return cc.Vec2,cc.Vec2,cc.Node,function(o,t,n){this.worldPos=o,this.normal=t,this.column=n}}(),r=function(){return cc.Node,cc.Vec2,cc.Vec2,cc.Vec2,cc.Float,function(o,t){this.column=o,this.columnWorldPos=this.column.parent.convertToWorldSpaceAR(this.column.position),this.startWorldPos=t,this.preTangentWorldPos=this.startWorldPos,this.rad=0}}(),h=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.PointArea=null,t.ropeEnd=null,t.ci=null,t.dis=null,t.lineWidth=0,t.mouseWorldPos=new cc.Vec2(0,0),t.points=[],t.columns=[],t.ctx=null,t.newTangentP=new cc.Vec2(0,1),t.c0=null,t}return __extends(t,o),t.prototype.onLoad=function(){this.ctx=this.getComponent(cc.Graphics),this.PointArea.on("touchstart",this.touchstart,this),this.PointArea.on("touchmove",this.touchmove,this),this.PointArea.on("touchend",this.touchup,this),this.PointArea.on("touchcancel",this.touchup,this),cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().debugDrawFlags=cc.PhysicsManager.DrawBits.e_aabbBit|cc.PhysicsManager.DrawBits.e_jointBit|cc.PhysicsManager.DrawBits.e_shapeBit,this.points.push(new c(this.node.parent.convertToWorldSpaceAR(this.node.position),new cc.Vec2(0,0),this.node)),this.columns.push(new r(this.node,this.node.parent.convertToWorldSpaceAR(this.node.position))),this.flag=!1},t.prototype.touchstart=function(o){this.flag=!0,this.mouseWorldPos=o.getLocation().add(new cc.Vec2(0,30))},t.prototype.touchmove=function(o){this.mouseWorldPos=o.getLocation().add(new cc.Vec2(0,30))},t.prototype.touchup=function(o){this.flag=!1},t.prototype.start=function(){},t.prototype.update=function(o){if(this.ctx.clear(),this.ctx.strokeColor=cc.Color.BLUE,this.ctx.LineJoin=cc.Graphics.LineJoin.ROUND,this.ctx.lineCap=cc.Graphics.LineCap.ROUND,this.dis.string=this.c0+this.columns[this.columns.length-1].preTangentWorldPos.sub(this.columns[this.columns.length-1].columnWorldPos).normalize()+this.newTangentP.sub(this.columns[this.columns.length-1].columnWorldPos).normalize(),this.flag?this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.mouseWorldPos.sub(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).mul(5):this.ropeEnd.convertToNodeSpaceAR(this.columns[this.columns.length-1].preTangentWorldPos).mag()<10?this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.ropeEnd.convertToNodeSpaceAR(this.columns[this.columns.length-1].preTangentWorldPos).mul(10):this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.ropeEnd.convertToNodeSpaceAR(this.columns[this.columns.length-1].preTangentWorldPos).normalize().mul(1e3),this.columns.length>1){this.CalcQieDian(this.columns[this.columns.length-1].columnWorldPos,this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].column.width/2,this.columns[this.columns.length-1].preTangentWorldPos);var t=cc.director.getPhysicsManager().rayCast(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].preTangentWorldPos,cc.RayCastType.Closest)}else t=cc.director.getPhysicsManager().rayCast(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].startWorldPos,cc.RayCastType.Closest);if(this.c0="asd",t.length>=1){this.c0=t[0].collider.node.name;var n=t[0].collider.node;if(n!=this.columns[this.columns.length-1].column){var e=this.CalcQieDian(n.parent.convertToWorldSpaceAR(n.position),this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),n.width/2,t[0].point),s=new r(n,e);this.columns.push(s)}else this.newTangentP=this.CalcQieDian(this.columns[this.columns.length-1].columnWorldPos,this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].column.width/2,this.columns[this.columns.length-1].preTangentWorldPos),this.ctx.strokeColor=cc.Color.RED,this.ctx.circle(this.node.convertToNodeSpaceAR(this.newTangentP).x,this.node.convertToNodeSpaceAR(this.newTangentP).y,10),this.ctx.stroke(),this.ctx.strokeColor=cc.Color.BLUE,this.columns[this.columns.length-1].rad*(this.columns[this.columns.length-1].rad+this.radTwoPOnR(this.columns[this.columns.length-1].preTangentWorldPos,this.newTangentP,this.columns[this.columns.length-1].columnWorldPos))<0?(console.log("!!!!!pop"),this.columns.pop()):(this.columns[this.columns.length-1].rad+=this.radTwoPOnR(this.columns[this.columns.length-1].preTangentWorldPos,this.newTangentP,this.columns[this.columns.length-1].columnWorldPos),this.columns[this.columns.length-1].preTangentWorldPos=this.newTangentP)}else this.columns.length>1&&(this.newTangentP=this.CalcQieDian(this.columns[this.columns.length-1].columnWorldPos,this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].column.width/2,this.columns[this.columns.length-1].preTangentWorldPos),this.ctx.strokeColor=cc.Color.RED,this.ctx.circle(this.node.convertToNodeSpaceAR(this.newTangentP).x,this.node.convertToNodeSpaceAR(this.newTangentP).y,10),this.ctx.stroke(),this.ctx.strokeColor=cc.Color.BLUE,this.columns[this.columns.length-1].rad*(this.columns[this.columns.length-1].rad+this.radTwoPOnR(this.columns[this.columns.length-1].preTangentWorldPos,this.newTangentP,this.columns[this.columns.length-1].columnWorldPos))<0?(console.log("!!!!!pop"),this.columns.pop()):(this.columns[this.columns.length-1].rad+=this.radTwoPOnR(this.columns[this.columns.length-1].preTangentWorldPos,this.newTangentP,this.columns[this.columns.length-1].columnWorldPos),this.columns[this.columns.length-1].preTangentWorldPos=this.newTangentP));this.ctx.lineWidth=this.lineWidth,this.ctx.moveTo(this.node.convertToNodeSpaceAR(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).x,this.node.convertToNodeSpaceAR(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).y);for(var i=this.columns.length-1;i>0;i--){if(1!=this.columns.length)var c=this.columns[i].preTangentWorldPos.sub(this.columns[i].columnWorldPos).normalize();var h=this.node.convertToNodeSpaceAR(this.columns[i].preTangentWorldPos.add(c.mul(this.lineWidth/2)));if(this.ctx.lineTo(h.x,h.y),this.columns[i].rad>=2*Math.PI)this.ctx.circle(this.node.convertToNodeSpaceAR(this.columns[i].columnWorldPos).x,this.node.convertToNodeSpaceAR(this.columns[i].columnWorldPos).y,this.columns[i].column.width/2+this.lineWidth/2),this.ctx.moveTo(this.node.convertToNodeSpaceAR(this.columns[i].preTangentWorldPos).x,this.node.convertToNodeSpaceAR(this.columns[i].preTangentWorldPos).y);else{var l=this.radOnePointOnCircle(this.columns[i].startWorldPos,this.columns[i].columnWorldPos);this.ctx.arc(this.node.convertToNodeSpaceAR(this.columns[i].columnWorldPos).x,this.node.convertToNodeSpaceAR(this.columns[i].columnWorldPos).y,this.columns[i].column.width/2+this.lineWidth/2,l,l+this.columns[i].rad,this.columns[i].rad>0)}var a=this.columns[i].startWorldPos.sub(this.columns[i].columnWorldPos).normalize(),p=this.node.convertToNodeSpaceAR(this.columns[i].startWorldPos.add(a.mul(this.lineWidth/2)));this.ctx.moveTo(p.x,p.y)}this.ctx.lineTo(0,0);this.CalcQieDian(this.ci.parent.convertToWorldSpaceAR(this.ci.position),this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),20);this.ctx.stroke()},t.prototype.CalcQieDian=function(o,t,n,e){void 0===e&&(e=new cc.Vec2(0,0));var s=new cc.Vec2(0,0),i=new cc.Vec2(0,0),c=(new cc.Vec2(0,0),new cc.Vec2(0,0),n/(s=t.sub(o)).mag());if(i=s.mul(c),this.radTwoPOnR(t,e,o)<0)var r=-Math.acos(c);else r=Math.acos(c);return i.rotate(r).add(o)},t.prototype.radTwoPOnR=function(o,t,n){var e=o.sub(n),s=t.sub(n);return e.signAngle(s)},t.prototype.radOnePointOnCircle=function(o,t){var n=o.sub(t);return new cc.Vec2(1,0).signAngle(n)},__decorate([i(cc.Node)],t.prototype,"PointArea",void 0),__decorate([i(cc.Node)],t.prototype,"ropeEnd",void 0),__decorate([i(cc.Node)],t.prototype,"ci",void 0),__decorate([i(cc.Label)],t.prototype,"dis",void 0),__decorate([i(cc.Float)],t.prototype,"lineWidth",void 0),t=__decorate([s],t)}(cc.Component);n.default=h,cc._RF.pop()},{}],"ropeScr - 002":[function(o,t,n){"use strict";cc._RF.push(t,"fd6852xH2BBVJhe4aKW5WVy","ropeScr - 002"),Object.defineProperty(n,"__esModule",{value:!0});var e=cc._decorator,s=e.ccclass,i=e.property,c=(function(){cc.Vec2,cc.Vec2,cc.Node}(),function(){return cc.Node,cc.Vec2,cc.Vec2,cc.Vec2,cc.Float,function(o,t){this.column=o,this.columnWorldPos=this.column.parent.convertToWorldSpaceAR(this.column.position),this.startWorldPos=t,this.preTangentWorldPos=this.startWorldPos,this.rad=0}}()),r=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.PointArea=null,t.ropeEnd=null,t.ci=null,t.lineWidth=0,t.mouseWorldPos=new cc.Vec2(0,0),t.points=[],t.columns=[],t.ctx=null,t.newTangentP=new cc.Vec2(0,1),t.c0=null,t}return __extends(t,o),t.prototype.onLoad=function(){this.ctx=this.getComponent(cc.Graphics),this.PointArea.on("touchstart",this.touchstart,this),this.PointArea.on("touchmove",this.touchmove,this),this.PointArea.on("touchend",this.touchup,this),this.PointArea.on("touchcancel",this.touchup,this),cc.director.getPhysicsManager().enabled=!0,this.columns.push(new c(this.node,this.node.parent.convertToWorldSpaceAR(this.node.position))),this.flag=!1},t.prototype.touchstart=function(o){this.flag=!0,this.mouseWorldPos=o.getLocation().add(new cc.Vec2(0,50))},t.prototype.touchmove=function(o){this.mouseWorldPos=o.getLocation().add(new cc.Vec2(0,50))},t.prototype.touchup=function(o){this.flag=!1},t.prototype.start=function(){},t.prototype.update=function(o){if(this.ctx.clear(),this.ctx.strokeColor=cc.color(0,100,100,255),this.ctx.LineJoin=cc.Graphics.LineJoin.ROUND,this.ctx.lineCap=cc.Graphics.LineCap.ROUND,this.flag?this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.mouseWorldPos.sub(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).mul(10):this.ropeEnd.convertToNodeSpaceAR(this.columns[this.columns.length-1].preTangentWorldPos).mag()<10?this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.ropeEnd.convertToNodeSpaceAR(this.columns[this.columns.length-1].preTangentWorldPos).mul(10):this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.ropeEnd.convertToNodeSpaceAR(this.columns[this.columns.length-1].preTangentWorldPos).normalize().mul(1e3),this.columns.length>1){this.CalcQieDian(this.columns[this.columns.length-1].columnWorldPos,this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].column.width/2,this.columns[this.columns.length-1].preTangentWorldPos);var t=cc.director.getPhysicsManager().rayCast(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].preTangentWorldPos,cc.RayCastType.Closest)}else t=cc.director.getPhysicsManager().rayCast(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].startWorldPos,cc.RayCastType.Closest);if(this.c0="asd",t.length>=1){this.c0=t[0].collider.node.name;var n=t[0].collider.node;if(n!=this.columns[this.columns.length-1].column){var e=this.CalcQieDian(n.parent.convertToWorldSpaceAR(n.position),this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),n.width/2,t[0].point),s=new c(n,e);this.columns.push(s),s.column.getComponent("columnScr").onLight()}else if(this.newTangentP=this.CalcQieDian(this.columns[this.columns.length-1].columnWorldPos,this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].column.width/2,this.columns[this.columns.length-1].preTangentWorldPos),this.ctx.strokeColor=cc.color(255,0,100,255),this.ctx.circle(this.newTangentP.x,this.newTangentP.y,10),this.ctx.stroke(),this.ctx.strokeColor=cc.color(0,100,100,255),this.columns[this.columns.length-1].rad*(this.columns[this.columns.length-1].rad+this.radTwoPOnR(this.columns[this.columns.length-1].preTangentWorldPos,this.newTangentP,this.columns[this.columns.length-1].columnWorldPos))<0){var i=this.columns.pop();0==this.ifOnlyColumn(i.column)&&i.column.getComponent("columnScr").cancelLight()}else this.columns[this.columns.length-1].rad+=this.radTwoPOnR(this.columns[this.columns.length-1].preTangentWorldPos,this.newTangentP,this.columns[this.columns.length-1].columnWorldPos),this.columns[this.columns.length-1].preTangentWorldPos=this.newTangentP}else if(this.columns.length>1)if(this.newTangentP=this.CalcQieDian(this.columns[this.columns.length-1].columnWorldPos,this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.columns[this.columns.length-1].column.width/2,this.columns[this.columns.length-1].preTangentWorldPos),this.ctx.strokeColor=cc.color(255,0,100,255),this.ctx.circle(this.newTangentP.x,this.newTangentP.y,10),this.ctx.stroke(),this.ctx.strokeColor=cc.color(0,100,100,255),this.columns[this.columns.length-1].rad*(this.columns[this.columns.length-1].rad+this.radTwoPOnR(this.columns[this.columns.length-1].preTangentWorldPos,this.newTangentP,this.columns[this.columns.length-1].columnWorldPos))<0){i=this.columns.pop();0==this.ifOnlyColumn(i.column)&&i.column.getComponent("columnScr").cancelLight()}else this.columns[this.columns.length-1].rad+=this.radTwoPOnR(this.columns[this.columns.length-1].preTangentWorldPos,this.newTangentP,this.columns[this.columns.length-1].columnWorldPos),this.columns[this.columns.length-1].preTangentWorldPos=this.newTangentP;if(this.columns.length>1){var r=this.columns[this.columns.length-1].startWorldPos.sub(this.columns[this.columns.length-1].columnWorldPos).rotate(this.columns[this.columns.length-1].rad/2).add(this.columns[this.columns.length-1].columnWorldPos);this.ctx.strokeColor=cc.Color.YELLOW,this.ctx.circle(r.x,r.y,10),this.ctx.stroke(),this.ctx.strokeColor=cc.color(0,100,100,255);var h=r.sub(this.columns[this.columns.length-1].columnWorldPos);if(Math.abs(this.columns[this.columns.length-1].rad)<2*Math.PI-.5&&h.normalize().dot(this.columns[this.columns.length-2].preTangentWorldPos.sub(this.columns[this.columns.length-1].startWorldPos).normalize())>0){i=this.columns.pop();0==this.ifOnlyColumn(i.column)&&i.column.getComponent("columnScr").cancelLight()}}this.ctx.lineWidth=this.lineWidth,this.ctx.moveTo(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position).x,this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position).y);for(var l=this.columns.length-1;l>0;l--){if(1!=this.columns.length)var a=this.columns[l].preTangentWorldPos.sub(this.columns[l].columnWorldPos).normalize();var p=this.columns[l].preTangentWorldPos.add(a.mul(this.lineWidth/2));if(this.ctx.lineTo(p.x,p.y),this.columns[l].rad>=2*Math.PI)this.ctx.circle(this.columns[l].columnWorldPos.x,this.columns[l].columnWorldPos.y,this.columns[l].column.width/2+this.lineWidth/2),this.ctx.moveTo(this.columns[l].preTangentWorldPos.x,this.columns[l].preTangentWorldPos.y);else{var d=this.radOnePointOnCircle(this.columns[l].startWorldPos,this.columns[l].columnWorldPos);this.ctx.arc(this.columns[l].columnWorldPos.x,this.columns[l].columnWorldPos.y,this.columns[l].column.width/2+this.lineWidth/2,d,d+this.columns[l].rad,this.columns[l].rad>0)}var u=this.columns[l].startWorldPos.sub(this.columns[l].columnWorldPos).normalize(),m=this.columns[l].startWorldPos.add(u.mul(this.lineWidth/2));this.ctx.moveTo(m.x,m.y)}this.ctx.lineTo(this.node.parent.convertToWorldSpaceAR(this.node.position).x,this.node.parent.convertToWorldSpaceAR(this.node.position).y);this.CalcQieDian(this.ci.parent.convertToWorldSpaceAR(this.ci.position),this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),20);this.ctx.stroke()},t.prototype.CalcQieDian=function(o,t,n,e){void 0===e&&(e=new cc.Vec2(0,0));var s=new cc.Vec2(0,0),i=new cc.Vec2(0,0),c=(new cc.Vec2(0,0),new cc.Vec2(0,0),n/(s=t.sub(o)).mag());if(i=s.mul(c),this.radTwoPOnR(t,e,o)<0)var r=-Math.acos(c);else r=Math.acos(c);return i.rotate(r).add(o)},t.prototype.radTwoPOnR=function(o,t,n){var e=o.sub(n),s=t.sub(n);return e.signAngle(s)},t.prototype.radOnePointOnCircle=function(o,t){var n=o.sub(t);return new cc.Vec2(1,0).signAngle(n)},t.prototype.ifOnlyColumn=function(o){for(var t=0,n=1;n<this.columns.length;n++)if(this.columns[n].column==o){t++;break}return t},__decorate([i(cc.Node)],t.prototype,"PointArea",void 0),__decorate([i(cc.Node)],t.prototype,"ropeEnd",void 0),__decorate([i(cc.Node)],t.prototype,"ci",void 0),__decorate([i(cc.Float)],t.prototype,"lineWidth",void 0),t=__decorate([s],t)}(cc.Component);n.default=r,cc._RF.pop()},{}],ropeScr:[function(o,t,n){"use strict";cc._RF.push(t,"da408F1uCVNIrR5eTz8jEWd","ropeScr"),Object.defineProperty(n,"__esModule",{value:!0});var e=cc._decorator,s=e.ccclass,i=e.property,c=function(){return cc.Vec2,cc.Vec2,cc.Node,function(o,t,n){this.worldPos=o,this.normal=t,this.column=n}}(),r=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.PointArea=null,t.ropeEnd=null,t.ci=null,t.dis=null,t.mouseWorldPos=new cc.Vec2(0,0),t.points=[],t.ctx=null,t}return __extends(t,o),t.prototype.onLoad=function(){this.ctx=this.getComponent(cc.Graphics),this.PointArea.on("touchstart",this.touchstart,this),this.PointArea.on("touchmove",this.touchmove,this),this.PointArea.on("touchend",this.touchup,this),this.PointArea.on("touchcancel",this.touchup,this),cc.director.getPhysicsManager().enabled=!0,this.points.push(new c(this.node.parent.convertToWorldSpaceAR(this.node.position),new cc.Vec2(0,0),this.node)),this.flag=!1},t.prototype.touchstart=function(o){this.flag=!0,this.mouseWorldPos=o.getLocation().add(new cc.Vec2(0,100))},t.prototype.touchmove=function(o){this.mouseWorldPos=o.getLocation().add(new cc.Vec2(0,100))},t.prototype.touchup=function(o){this.flag=!1},t.prototype.start=function(){},t.prototype.update=function(o){this.flag?this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.mouseWorldPos.sub(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).mul(5):this.ropeEnd.convertToNodeSpaceAR(this.points[this.points.length-1].worldPos).mag()<10?this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.ropeEnd.convertToNodeSpaceAR(this.points[this.points.length-1].worldPos).mul(10):this.ropeEnd.getComponent(cc.RigidBody).linearVelocity=this.ropeEnd.convertToNodeSpaceAR(this.points[this.points.length-1].worldPos).normalize().mul(1e3);var t=cc.director.getPhysicsManager().rayCast(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),this.points[this.points.length-1].worldPos,cc.RayCastType.Any);if(this.ctx.lineWidth=10,this.ctx.clear(),this.ctx.LineJoin=cc.Graphics.LineJoin.ROUND,this.ctx.lineCap=cc.Graphics.LineCap.ROUND,t.length>=1&&"ropeEnd"!=t[0].collider.node.name){var n=t[0].point,e=new c(n=n,t[0].normal,t[0].collider.node);this.points.push(e)}for(;this.points.length>1;){if(!(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position).sub(this.points[this.points.length-1].worldPos).angle(this.points[this.points.length-1].normal)<Math.PI/2-.5))break;this.points.pop()}this.ctx.moveTo(this.node.convertToNodeSpaceAR(this.points[0].worldPos).x,this.node.convertToNodeSpaceAR(this.points[0].worldPos).y);for(var s=this.points[0].column,i=0,r=0,h=!0,l=1;l<this.points.length;l++)this.points[l].column==s&&(i+=this.radTwoPOnR(this.points[l-1].worldPos,this.points[l].worldPos,this.points[l].column.parent.convertToWorldSpaceAR(this.points[l].column.position))),this.points[l].column==s&&l!=this.points.length-1||(this.dis.string=r.toString()+"\n"+i.toString(),0!=i&&(Math.abs(i)>2*Math.PI?(this.ctx.circle(this.node.convertToNodeSpaceAR(s.parent.convertToWorldSpaceAR(s.position)).x,this.node.convertToNodeSpaceAR(s.parent.convertToWorldSpaceAR(s.position)).y,s.width/2+5),this.ctx.moveTo(this.node.convertToNodeSpaceAR(this.points[l-1].worldPos.add(this.points[l-1].normal.normalize().mul(5))).x,this.node.convertToNodeSpaceAR(this.points[l-1].worldPos.add(this.points[l-1].normal.normalize().mul(5))).y)):(h=i>0,this.ctx.arc(this.node.convertToNodeSpaceAR(s.parent.convertToWorldSpaceAR(s.position)).x,this.node.convertToNodeSpaceAR(s.parent.convertToWorldSpaceAR(s.position)).y,s.width/2+5,r,r+i,h),this.ctx.moveTo(this.node.convertToNodeSpaceAR(this.points[l-1].worldPos.add(this.points[l-1].normal.normalize().mul(5))).x,this.node.convertToNodeSpaceAR(this.points[l-1].worldPos.add(this.points[l-1].normal.normalize().mul(5))).y))),this.ctx.lineTo(this.node.convertToNodeSpaceAR(this.points[l].worldPos.add(this.points[l].normal.normalize().mul(5))).x,this.node.convertToNodeSpaceAR(this.points[l].worldPos.add(this.points[l].normal.normalize().mul(5))).y),r=this.radOnePointOnCircle(this.points[l].worldPos,this.points[l].column.parent.convertToWorldSpaceAR(this.points[l].column.position)),s=this.points[l].column,i=0);this.ctx.lineTo(this.node.convertToNodeSpaceAR(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).x,this.node.convertToNodeSpaceAR(this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position)).y);var a=this.CalcQieDian(this.ci.parent.convertToWorldSpaceAR(this.ci.position),this.ropeEnd.parent.convertToWorldSpaceAR(this.ropeEnd.position),20);this.ctx.circle(this.node.convertToNodeSpaceAR(a).x,this.node.convertToNodeSpaceAR(a).y,5),this.ctx.stroke()},t.prototype.CalcQieDian=function(o,t,n){var e=new cc.Vec2(0,0),s=new cc.Vec2(0,0),i=new cc.Vec2(0,0),c=new cc.Vec2(0,0),r=n;e.x=t.x-o.x,e.y=t.y-o.y;var h=r/Math.sqrt(e.x*e.x+e.y*e.y);s.x=e.x*h,s.y=e.y*h;var l=-Math.acos(h);return i.x=s.x*Math.cos(l)-s.y*Math.sin(l),i.y=s.x*Math.sin(l)+s.y*Math.cos(l),c.x=i.x+o.x,c.y=i.y+o.y,c},t.prototype.radTwoPOnR=function(o,t,n){var e=o.sub(n),s=t.sub(n);return e.signAngle(s)},t.prototype.radOnePointOnCircle=function(o,t){var n=o.sub(t);return new cc.Vec2(1,0).signAngle(n)},__decorate([i(cc.Node)],t.prototype,"PointArea",void 0),__decorate([i(cc.Node)],t.prototype,"ropeEnd",void 0),__decorate([i(cc.Node)],t.prototype,"ci",void 0),__decorate([i(cc.Label)],t.prototype,"dis",void 0),t=__decorate([s],t)}(cc.Component);n.default=r,cc._RF.pop()},{}]},{},["CanvasScr","DrawImage","columnScr","ropeScr - 001","ropeScr - 002","ropeScr"]);